<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checklist Diário - Empilhadeira Log20</title>
<style>
body { font-family: Arial, sans-serif; background-color: #0d1f0d; color: white; margin: 0; padding: 20px; }
.container { max-width: 700px; margin: auto; background-color: #1f3b1f; padding: 20px; border-radius: 10px; }
h2 { text-align: center; }
button { padding: 10px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; }
.btn-group { display: flex; justify-content: space-between; gap: 10px; margin-top: 15px; }
.btn-yes { background-color: #28a745; }
.btn-no { background-color: #dc3545; }
.btn-yes.active { background-color: #3cd65a; transform: scale(1.05); }
.btn-no.active { background-color: #ff4d4d; transform: scale(1.05); }
.hidden { display: none; }
img { width: 100%; border-radius: 10px; margin-bottom: 10px; }
textarea { width: 100%; border-radius: 6px; padding: 8px; }
</style>
</head>
<body>

<div id="pagina-inicial" class="container">
  <h2>Checklist Diário - Empilhadeira Log20</h2>
  <label>Nome do Operador:</label>
  <input id="operador" type="text" placeholder="Digite o nome do operador">
  <label>Número da Máquina:</label>
  <input id="maquina" type="text" placeholder="Digite o número da máquina">
  <label>Horímetro:</label>
  <input id="horimetro" type="number" step="0.1" placeholder="Ex: 3456.7">
  <button onclick="iniciarChecklist()">Iniciar Checklist</button>
</div>

<div id="pagina-checklist" class="container hidden">
  <h2 id="titulo-item"></h2>
  <img id="imagem-item" src="" alt="Imagem do item">
  <div class="btn-group">
    <button class="btn-yes" id="btn-sim" onclick="responder('Sim')">Sim</button>
    <button class="btn-no" id="btn-nao" onclick="responder('Não')">Não</button>
  </div>
  <div id="descricao-wrap" class="hidden">
    <label>Descreva o problema:</label>
    <textarea id="descricao"></textarea>
    <button onclick="mudarItem(1)">Próximo</button>
  </div>
  <div style="text-align:center; margin-top:10px;">
    <span id="contador"></span>
  </div>
</div>

<div id="pagina-observacoes" class="container hidden">
  <h2>Observações Finais</h2>
  <textarea id="observacoes" placeholder="Digite observações gerais..."></textarea>
  <button id="btn-pdf" onclick="gerarPDF()" disabled>⏳ Aguarde 3:00 para gerar PDF</button>
</div>

<div id="pagina-sucesso" class="container hidden">
  <h2 style="text-align:center;">✅ Checklist Finalizado!</h2>
  <p style="text-align:center;">O relatório foi gerado e baixado com sucesso.</p>
  <button onclick="location.reload()">Voltar ao início</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
const { jsPDF } = window.jspdf;
const perguntas = [
  "Pontos de apoio estão OK?",
  "Painel de instrumentos está OK?",
  "Sensor de banco está OK?",
  "Cinto de segurança está OK?",
  "Buzina está OK?",
  "Sensor de cinto está OK?",
  "Limpador de para-brisas está OK?",
  "Para-brisa e teto estão OK?",
  "Retrovisores estão OK?",
  "Freios estão OK?",
  "Extintor está OK?",
  "LEDs laterais estão OK?",
  "Blue Spot está OK?",
  "Lâmpadas dianteiras estão OK?",
  "Lâmpadas traseiras estão OK?",
  "Sirene de ré está OK?",
  "Ausência de vazamento de óleo?",
  "Mangueiras da torre estão OK?",
  "Garfo está OK?",
  "Pneus estão OK?",
  "Rodas estão OK?"
];

const imagens = [
  "https://cdn.pixabay.com/photo/2016/11/18/15/16/forklift-1838831_1280.jpg",
  "https://cdn.pixabay.com/photo/2021/07/20/07/46/forklift-6481134_1280.jpg",
  "https://cdn.pixabay.com/photo/2016/11/19/17/19/industry-1839134_1280.jpg",
  "https://cdn.pixabay.com/photo/2018/01/23/10/07/forklift-3100814_1280.jpg",
  "https://cdn.pixabay.com/photo/2018/05/11/09/49/forklift-3387385_1280.jpg",
  "https://cdn.pixabay.com/photo/2021/06/01/12/23/forklift-6302902_1280.jpg",
  "https://cdn.pixabay.com/photo/2022/04/29/07/29/forklift-7165275_1280.jpg",
  "https://cdn.pixabay.com/photo/2017/01/23/19/23/forklift-2000816_1280.jpg",
  "https://cdn.pixabay.com/photo/2016/11/18/15/16/forklift-1838831_1280.jpg",
  "https://cdn.pixabay.com/photo/2018/02/12/15/07/forklift-3141943_1280.jpg",
  "https://cdn.pixabay.com/photo/2017/04/19/13/02/fire-extinguisher-2247516_1280.jpg",
  "https://cdn.pixabay.com/photo/2021/06/01/12/23/forklift-6302902_1280.jpg",
  "https://cdn.pixabay.com/photo/2018/01/23/10/07/forklift-3100814_1280.jpg",
  "https://cdn.pixabay.com/photo/2016/11/18/15/16/forklift-1838831_1280.jpg",
  "https://cdn.pixabay.com/photo/2018/05/11/09/49/forklift-3387385_1280.jpg",
  "https://cdn.pixabay.com/photo/2018/02/12/15/07/forklift-3141943_1280.jpg",
  "https://cdn.pixabay.com/photo/2017/03/23/16/14/machine-2166563_1280.jpg",
  "https://cdn.pixabay.com/photo/2017/01/23/19/23/forklift-2000816_1280.jpg",
  "https://cdn.pixabay.com/photo/2018/05/11/09/49/forklift-3387385_1280.jpg",
  "https://cdn.pixabay.com/photo/2021/06/01/12/23/forklift-6302902_1280.jpg",
  "https://cdn.pixabay.com/photo/2016/11/18/15/16/forklift-1838831_1280.jpg"
];

let indice = 0;
const respostas = {};
const descricoes = {};
let tempoRestante = 180;
let timer;

function iniciarChecklist() {
  const operador = document.getElementById('operador').value.trim();
  const maquina = document.getElementById('maquina').value.trim();
  const horimetro = document.getElementById('horimetro').value.trim();
  if (!operador || !maquina || !horimetro) {
    alert("Preencha todos os campos!");
    return;
  }
  document.getElementById('pagina-inicial').classList.add('hidden');
  document.getElementById('pagina-checklist').classList.remove('hidden');
  mostrarItem(0);
  iniciarTemporizador();
}

function mostrarItem(i) {
  indice = i;
  document.getElementById('titulo-item').innerText = perguntas[i];
  document.getElementById('imagem-item').src = imagens[i];
  document.getElementById('descricao').value = '';
  document.getElementById('descricao-wrap').classList.add('hidden');
  document.getElementById('contador').innerText = `Item ${i+1} de ${perguntas.length}`;
}

function responder(valor) {
  const p = perguntas[indice];
  respostas[p] = valor;
  if (valor === 'Sim') {
    setTimeout(() => mudarItem(1), 300);
  } else {
    document.getElementById('descricao-wrap').classList.remove('hidden');
  }
}

function mudarItem(d) {
  if (d > 0 && respostas[perguntas[indice]] === 'Não') {
    const desc = document.getElementById('descricao').value.trim();
    if (!desc) { alert("Descreva o problema antes de continuar!"); return; }
    descricoes[perguntas[indice]] = desc;
  }
  if (indice + d < perguntas.length) {
    mostrarItem(indice + d);
  } else {
    document.getElementById('pagina-checklist').classList.add('hidden');
    document.getElementById('pagina-observacoes').classList.remove('hidden');
  }
}

function iniciarTemporizador() {
  const btn = document.getElementById('btn-pdf');
  btn.disabled = true;
  btn.innerText = "⏳ Aguarde 3:00 para gerar PDF";
  timer = setInterval(() => {
    tempoRestante--;
    const min = Math.floor(tempoRestante / 60);
    const seg = (tempoRestante % 60).toString().padStart(2, '0');
    btn.innerText = `⏳ Aguarde ${min}:${seg} para gerar PDF`;
    if (tempoRestante <= 0) {
      clearInterval(timer);
      btn.disabled = false;
      btn.innerText = "✅ Gerar Relatório (PDF)";
    }
  }, 1000);
}

function gerarPDF() {
  if (tempoRestante > 0) {
    alert("Aguarde o tempo mínimo de 3 minutos para gerar o relatório.");
    return;
  }
  const doc = new jsPDF({ unit: "pt", format: "a4" });
  const operador = document.getElementById('operador').value.trim();
  const maquina = document.getElementById('maquina').value.trim();
  const horimetro = document.getElementById('horimetro').value.trim();
  const observacoes = document.getElementById('observacoes').value.trim();
  doc.text("Checklist Diário - Empilhadeira Log20", doc.internal.pageSize.getWidth() / 2, 40, { align: "center" });
  doc.setFontSize(10);
  doc.text(`Operador: ${operador} | Máquina: ${maquina} | Horímetro: ${horimetro}`, 40, 60);
  const body = perguntas.map(p => [p, respostas[p] || "Não respondido", descricoes[p] || ""]);
  doc.autoTable({ startY: 80, head: [["Item", "Situação", "Descrição"]], body: body, styles: { fontSize: 9 }, headStyles: { fillColor: [200, 200, 200] } });
  doc.text("Observações Finais:", 40, doc.lastAutoTable.finalY + 30);
  doc.text(observacoes || "Nenhuma observação.", 40, doc.lastAutoTable.finalY + 45);
  doc.save(`Checklist_${operador || 'Operador'}.pdf`);
  document.getElementById('pagina-observacoes').classList.add('hidden');
  document.getElementById('pagina-sucesso').classList.remove('hidden');
}
</script>
</body>
</html>